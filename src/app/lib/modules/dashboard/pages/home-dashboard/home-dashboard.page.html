<app-main-header-layout></app-main-header-layout>
<app-header-page title="Dashboard"></app-header-page>
<ion-content class="ion-padding">

    <ion-grid class="ion-no-padding">

        <ion-row>

            <ion-col size="12">

                <ion-card>
                    <ion-card-header>
                        <ion-card-title>
                            <ion-item lines="none"
                                *ngIf="sessionService.userSessionAsObservable | async as userSession">
                                <ion-thumbnail slot="start">
                                    <app-avatar [username]="userSession.username"></app-avatar>
                                </ion-thumbnail>
                                <ion-label>
                                    <h2>Bienvenido, {{ userSession.name }} {{ userSession.lastName }}</h2>
                                    <p>Consulta tu información al momento</p>
                                </ion-label>
                                <ion-buttons slot="end">
                                    <ion-button [routerLink]="[settingsRoutes.SETTINGS_MY_PROFILE]"
                                        routerDirection="root" color="primary" fill="clear">
                                        <ion-icon name="person-circle-outline" slot="start"></ion-icon>
                                        Mi Perfil
                                    </ion-button>
                                </ion-buttons>
                            </ion-item>
                        </ion-card-title>
                    </ion-card-header>
                    <ion-card-content>
                        <app-filter-date-select label="Fitra por un rango de fechas" [filters]="filters"
                            [hideDefault]="true" (dateChange)="onDateChange($event)">
                        </app-filter-date-select>
                    </ion-card-content>
                </ion-card>

            </ion-col>

            <ion-col size="12" sizeMd="4">
                <app-card-summary title="Ganancias" icon="assets/imgs/money-icon.svg" [value]="summary.revenue"
                    [isMoneyFormat]="true"></app-card-summary>
            </ion-col>

            <ion-col size="12" sizeMd="4">
                <app-card-summary title="Nuevas ordenes" icon="assets/imgs/new-order-icon.svg"
                    [value]="summary.totalOrderRepairs">
                </app-card-summary>
            </ion-col>

            <ion-col size="12" sizeMd="4">
                <app-card-summary title="Nuevos clientes" icon="assets/imgs/new-customer-icon.svg"
                    [value]="summary.totalNewCustomers">
                </app-card-summary>
            </ion-col>

        </ion-row>

        <ion-row>

            <ion-col size="12" sizeMd="6" class="col-section">
                <ion-card>
                    <ion-card-header>
                        <ion-card-subtitle>Ordenes de reparación</ion-card-subtitle>
                        <ion-card-title>Ultimas registradas</ion-card-title>
                    </ion-card-header>
                    <ion-card-content>

                        <ion-list lines="full" *ngIf="lastOrders.length > 0">
                            <ion-item *ngFor="let orderRepair of lastOrders">
                                <ion-icon name="journal" slot="start"></ion-icon>
                                <ion-label>
                                    <h2 class="header-order-repair">
                                        <ion-badge color="dark" class="ion-margin-end">
                                            {{ orderRepair.getOrderIdFormat() }}
                                        </ion-badge>
                                        <app-order-repair-status [orderRepairId]="orderRepair._id" [showChip]="false"
                                            [currentStatus]="orderRepair.status" [isView]="true"
                                            class="ion-hide-md-down"></app-order-repair-status>
                                        <app-order-repair-paid-status [isPaid]="orderRepair.isPaid"
                                            [orderRepairId]="orderRepair._id" [isView]="true" [showChip]="false"
                                            class="ion-hide-md-down"></app-order-repair-paid-status>
                                    </h2>
                                    <h3>{{ orderRepair.createdAt | date:'short' }}</h3>
                                    <p>{{ orderRepair.getCustomerFullName() }}</p>
                                    <p>
                                        <span class="ion-margin-end" style="font-weight: bold">Total</span>
                                        <span>{{ orderRepair.totalAmount | currency:'MXN' }}</span>
                                        <ng-container *ngIf="!orderRepair.isPaid">
                                            <span class="ion-margin-horizontal" style="font-weight: bold">Resta</span>
                                            <span>{{ orderRepair.remainingAmount | currency:'MXN' }}</span>
                                        </ng-container>
                                    </p>
                                </ion-label>
                                <ion-buttons slot="end">
                                    <ion-button (click)="onViewOrder(orderRepair._id)" color="medium">
                                        <ion-icon slot="icon-only" name="eye-outline"></ion-icon>
                                    </ion-button>
                                </ion-buttons>
                            </ion-item>
                        </ion-list>

                        <app-not-found-data *ngIf="lastOrders.length === 0"></app-not-found-data>

                    </ion-card-content>
                </ion-card>
            </ion-col>

            <ion-col size="12" sizeMd="6" class="col-section">
                <ion-card>
                    <ion-card-header>
                        <ion-card-subtitle>Ordenes de reparación</ion-card-subtitle>
                        <ion-card-title>Pendientes de pagar</ion-card-title>
                    </ion-card-header>
                    <ion-card-content>

                        <ion-list lines="full" *ngIf="ordersPendingToPay.length > 0">
                            <ion-item *ngFor="let orderRepair of ordersPendingToPay">
                                <ion-icon name="journal" slot="start"></ion-icon>
                                <ion-label>
                                    <h2 class="header-order-repair">
                                        <ion-badge color="dark" class="ion-margin-end">
                                            {{ orderRepair.getOrderIdFormat() }}
                                        </ion-badge>
                                        <app-order-repair-status [orderRepairId]="orderRepair._id"
                                            [currentStatus]="orderRepair.status" [isView]="true" [showChip]="false"
                                            class="ion-hide-md-down"></app-order-repair-status>
                                        <app-order-repair-paid-status [isPaid]="orderRepair.isPaid"
                                            [orderRepairId]="orderRepair._id" [isView]="true" [showChip]="false"
                                            class="ion-hide-md-down"></app-order-repair-paid-status>
                                    </h2>
                                    <h3>{{ orderRepair.createdAt | date:'short' }}</h3>
                                    <p>{{ orderRepair.getCustomerFullName() }}</p>
                                    <p>{{ orderRepair.getCustomerPhone() }}</p>
                                    <p>
                                        <span class="ion-margin-end" style="font-weight: bold">Total</span>
                                        <span>{{ orderRepair.totalAmount | currency:'MXN' }}</span>
                                        <ng-container *ngIf="!orderRepair.isPaid">
                                            <span class="ion-margin-horizontal" style="font-weight: bold">Resta</span>
                                            <span>{{ orderRepair.remainingAmount | currency:'MXN' }}</span>
                                        </ng-container>
                                    </p>
                                </ion-label>
                                <ion-buttons slot="end">
                                    <ion-button (click)="onViewOrder(orderRepair._id)" color="medium">
                                        <ion-icon slot="icon-only" name="eye-outline"></ion-icon>
                                    </ion-button>
                                </ion-buttons>
                            </ion-item>
                        </ion-list>

                        <app-not-found-data *ngIf="ordersPendingToPay.length === 0"></app-not-found-data>

                    </ion-card-content>
                </ion-card>
            </ion-col>

        </ion-row>

    </ion-grid>

</ion-content>